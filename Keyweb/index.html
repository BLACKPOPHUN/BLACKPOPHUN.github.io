<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Get Key</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
body{background:#0f0f0f;color:white;font-family:sans-serif;text-align:center;padding:40px}
button{padding:12px 28px;font-size:18px;cursor:pointer}
pre{background:#1a1a1a;padding:15px;margin-top:20px}
</style>
</head>
<body>

<h2>ðŸ”‘ à¸£à¸±à¸š Key (12 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡)</h2>
<button id="btn" onclick="createKey()">à¸£à¸±à¸š Key</button>
<pre id="out">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µ Key</pre>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA4nwk8ZPeVvoLOR4UyPLP-yVUyhlinEN8",
  authDomain: "blackpophun.firebaseapp.com",
  databaseURL: "https://blackpophun-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "blackpophun",
  storageBucket: "blackpophun.appspot.com",
  messagingSenderId: "735578888290",
  appId: "1:735578888290:web:b68c60a5bdba76880ed93b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Device ID (à¸œà¸¹à¸à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡)
let deviceId = localStorage.getItem("device_id");
if(!deviceId){
    deviceId = "DEV-" + crypto.randomUUID();
    localStorage.setItem("device_id", deviceId);
}

function genKey(){
    return "BP-" +
    Math.random().toString(36).substr(2,4).toUpperCase() +
    "-" +
    Math.random().toString(36).substr(2,4).toUpperCase();
}

// à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸²à¸¡à¸µ key à¸„à¹‰à¸²à¸‡à¸­à¸¢à¸¹à¹ˆà¹„à¸«à¸¡
db.ref("devices/"+deviceId).once("value").then(snap=>{
    if(snap.exists() && Date.now() < snap.val().expire){
        document.getElementById("btn").disabled = true;
        document.getElementById("out").textContent =
          "KEY: "+snap.val().key+
          "\nà¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸: "+new Date(snap.val().expire).toLocaleString();
    }
});

function createKey(){
    const key = genKey();
    const expire = Date.now() + 12*60*60*1000;

    db.ref("devices/"+deviceId).set({
        key: key,
        expire: expire
    });

    db.ref("keys/"+key).set({
        device: deviceId,
        expire: expire
    });

    document.getElementById("btn").disabled = true;
    document.getElementById("out").textContent =
      "KEY: "+key+
      "\nà¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸: "+new Date(expire).toLocaleString();
}
</script>

</body>
</html>
