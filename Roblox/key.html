<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>BlackpopHub | Key System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:sans-serif;background:#0e0e0e;color:white;padding:20px}
.box{max-width:420px;margin:auto;background:#161616;padding:20px;border-radius:10px;margin-bottom:20px}
h2{text-align:center}
input,button{width:100%;padding:12px;margin-top:10px;border:none;border-radius:6px;font-size:16px}
input{background:#222;color:white}
button{background:#00b3ff;color:black;font-weight:bold;cursor:pointer}
.result{text-align:center;margin-top:10px}
.success{color:#00ff9d}
.error{color:#ff4d4d}
</style>
</head>
<body>

<!-- ADMIN -->
<div class="box">
<h2>üîë ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏µ‡∏¢‡πå (24 ‡∏ä‡∏°.)</h2>
<button onclick="generateKey()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏µ‡∏¢‡πå</button>
<div id="gen" class="result"></div>
</div>

<!-- LOGIN -->
<div class="box">
<h2>üîê Login ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏µ‡∏¢‡πå</h2>
<input id="keyInput" placeholder="‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå">
<button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
<div id="login" class="result"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey: "AIzaSyA4nwk8ZPeVvoLOR4UyPLP-yVUyhlinEN8",
 authDomain: "blackpophun.firebaseapp.com",
 databaseURL: "https://blackpophun-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId: "blackpophun",
 storageBucket: "blackpophun.appspot.com",
 messagingSenderId: "735578888290",
 appId: "1:735578888290:web:b68c60a5bdba76880ed93b"
});

const db = firebase.database();
const DAY = 24 * 60 * 60 * 1000;

/* ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏µ‡∏¢‡πå */
function generateKey(){
 const key = makeKey();
 const now = Date.now();

 db.ref("keys/"+key).set({
   used:false,
   createdAt:now,
   expiresAt: now + DAY
 });

 document.getElementById("gen").innerHTML =
  `<span class="success">${key}</span>`;
}

/* Login */
function login(){
 const key = keyInput.value.trim();
 if(!key) return;

 db.ref("keys/"+key).get().then(snap=>{
   if(!snap.exists())
     return show("login","‡∏Ñ‡∏µ‡∏¢‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error");

   const d = snap.val();
   if(d.used)
     return show("login","‡∏Ñ‡∏µ‡∏¢‡πå‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß","error");

   if(Date.now() > d.expiresAt)
     return show("login","‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏","error");

   db.ref("keys/"+key).update({used:true});
   localStorage.setItem("login_key", key);

   show("login","‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success");

   setTimeout(()=>{
     window.location.href = "dashboard.html";
   },800);
 });
}

/* utils */
function makeKey(){
 return "BP-" +
 Math.random().toString(36).substring(2,6).toUpperCase() +
 "-" +
 Math.random().toString(36).substring(2,6).toUpperCase();
}
function show(id,msg,type){
 document.getElementById(id).innerHTML =
 `<span class="${type}">${msg}</span>`;
}
</script>
</body>
</html>
