<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlackpopHub Ultimate</title>
<style>
body{font-family:sans-serif;background:#121212;color:white;margin:0;padding:20px;}
h2{text-align:center;font-size:28px;margin-bottom:20px;}
input,button,textarea{border-radius:6px;border:none;outline:none;}
input{width:calc(100% - 16px);padding:8px;margin:5px 0;}
button{padding:10px 15px;margin:5px 0;background:#ff003c;color:white;cursor:pointer;transition:.3s;}
button:hover{background:#2563eb;}
a{color:#00f;cursor:pointer;display:block;text-align:center;margin-top:5px;}
.box{background:#1e1e1e;padding:15px;margin:0 auto 20px auto;width:90%;max-width:700px;border-radius:12px;box-shadow:0 0 10px #00000050;position:relative;}
textarea{width:100%;height:100px;padding:10px;resize:none;background:#111;color:#eee;font-size:14px;}
textarea[readonly]{background:#222;}
.msg{color:#8bf48a;display:none;margin-top:8px;text-align:center;}
#logout{position:fixed;left:10px;bottom:10px;padding:15px 20px;background:#ff6600;font-size:16px;border-radius:8px;cursor:pointer;display:none;transition:.3s;}
#logout:hover{background:#ff3300;transform: scale(1.05);}
#username-btn{position:fixed;right:10px;top:10px;background:#2563eb;padding:10px 15px;border-radius:8px;cursor:pointer;display:none;}
#user-time-box{position:fixed;right:10px;top:50px;background:#333;padding:10px;border-radius:8px;display:none;max-width:200px;word-break:break-word;}
.edit-btn{background:#ff9800;margin-left:10px;}
.edit-btn:hover{background:#f57c00;}
.save-btn{background:#4caf50;}
.save-btn:hover{background:#45a049;}
.cancel-btn{background:#666;}
.cancel-btn:hover{background:#555;}
.delete-btn{background:#f44336;position:absolute;top:15px;right:15px;}
.delete-btn:hover{background:#d32f2f;}
.editing-indicator{color:#ff9800;font-size:12px;margin-top:5px;display:none;}
#add-script-btn{background:#4caf50;width:90%;max-width:700px;display:none;margin:20px auto;font-size:18px;padding:15px;}
#add-script-btn:hover{background:#45a049;}
.online-users{position:fixed;left:10px;top:10px;background:#333;padding:10px;border-radius:8px;font-size:12px;max-width:150px;display:none;}
.online-dot{display:inline-block;width:8px;height:8px;background:#4caf50;border-radius:50%;margin-right:5px;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.5;}}
@media(max-width:480px){h2{font-size:24px;}#logout,#username-btn{padding:10px 12px;font-size:14px;}.online-users{position:static;margin-bottom:10px;max-width:100%;}}
</style>
</head>
<body>

<!-- Login -->
<div id="login-container" class="box">
<h2>Login</h2>
<input type="text" id="login-username" placeholder="Username"><br>
<input type="password" id="login-password" placeholder="Password"><br>
<button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
<a onclick="showRegister()">‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™</a>
<p id="login-msg" style="color:red;"></p>
</div>

<!-- Register -->
<div id="register-container" class="box" style="display:none;">
<h2>‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™</h2>
<p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login</p>
<button onclick="openCodeSite()">‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î</button>
<a onclick="showLogin()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login</a>
</div>

<!-- Scripts -->
<div id="script-container" style="display:none;">
<div id="online-users" class="online-users"></div>
<h2>Script Roblox</h2>
<div id="scripts-list"></div>
<button id="add-script-btn" onclick="addNewScript()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á Script ‡πÉ‡∏´‡∏°‡πà</button>
</div>

<div id="logout" onclick="logout()">Logout</div>
<div id="username-btn" onclick="toggleUserTime()">User</div>
<div id="user-time-box"></div>

<script>
// ===== URL RANDOMIZER =====
let urlRandomizerInterval=null;
function startUrlRandomizer(){
    if(urlRandomizerInterval)clearInterval(urlRandomizerInterval);
    urlRandomizerInterval=setInterval(()=>{
        const path=Math.random().toString(36).substring(2,1000);
        window.history.replaceState({},'', '/'+path);
    },50);
}

// ===== GLOBAL =====
let currentUser=null,loginTime=null,intervalTimer=null,syncTimer=null,heartbeatTimer=null,scripts=[],sessionId=Date.now()+'_'+Math.random().toString(36).substr(2,9);
let storageAvailable=false;

// ===== INITIAL SCRIPTS =====
const initialScripts=[
    {id:1,title:"BPHub ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ BlackpopHub (1)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/BPHUB",true))()`},
    {id:2,title:"BPHUB V1.2 (1.1)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/BPHUB-V1.2",true))()`},
    {id:3,title:"Blox Fruit (2)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/flazhy/QuantumOnyx/refs/heads/main/QuantumOnyx.lua"))()`},
    {id:4,title:"99 ‡∏Ñ‡∏∑‡∏ô (3)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/FoxnameHub-99Day"))()`},
    {id:5,title:"99 ‡∏Ñ‡∏∑‡∏ô ‡πÄ‡∏°‡∏ô‡∏π‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (3.1)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/TH-99Day"))()`},
    {id:6,title:"Auto ‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏û‡∏ä‡∏£ 99 ‡∏Ñ‡∏∑‡∏ô (3.2)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/Auto-farm-Gem-99Day",true))()`},
    {id:7,title:"Fisch (4)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/Auto-Farm-Fishing",true))()`},
    {id:8,title:"[FPS] Flick (5)",content:`getgenv().unxns={loadfrom:"ScriptBlox"};loadstring(game:HttpGet("https://apigetunx.vercel.app/UNX.lua",true))()`},
    {id:9,title:"The Forge [Beta] (6)",content:`loadstring(game:HttpGet("https://rawscripts.net/raw/The-Forge-BETA-goldtm-55-features-keyless-every-sat-72847"))()`},
    {id:10,title:"Don't Get Crushed By 67 (7)",content:`loadstring(game:HttpGet("https://pastebin.com/raw/EBe1Afue",true))()`},
    {id:11,title:"[üéôÔ∏è] Wizard Arena (8)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/NumbZer0/Spectrum-X/refs/heads/main/WizardArena.lua"))()`},
    {id:12,title:"[‚ùÑÔ∏è] Raise Animals (9)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/MQPS7/NoPlan/refs/heads/main/Raise%20Animals"))()`},
    {id:13,title:"[üéÅ] Steal a Brainrot (10)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/IzyHubScript/Brainrothubscript/refs/heads/main/Brainrothubscript"))()`},
    {id:14,title:"[üéÑ] Prison Life (11)",content:`loadstring(game:HttpGet("https://raw.githubusercontent.com/BLACKPOPHUN/script-BPHUB/refs/heads/main/Script/Prison_Life-NoclipBypass",true))()`}
];

// ===== STORAGE HELPERS =====
async function checkStorage(){storageAvailable=(typeof window.storage!=='undefined');}
async function getSharedData(k){return storageAvailable?(await window.storage.get(k,true))?.value?JSON.parse((await window.storage.get(k,true)).value):null:JSON.parse(localStorage.getItem(k));}
async function setSharedData(k,v){storageAvailable?await window.storage.set(k,JSON.stringify(v),true):localStorage.setItem(k,JSON.stringify(v));}
async function deleteSharedData(k){storageAvailable?await window.storage.delete(k,true):localStorage.removeItem(k);}
async function listSharedKeys(prefix){if(!storageAvailable){const keys=[];for(let i=0;i<localStorage.length;i++){const key=localStorage.key(i);if(key.startsWith(prefix))keys.push(key);}return keys;}try{const res=await window.storage.list(prefix,true);return res?.keys||[];}catch{return[];}}

// ===== LOGIN =====
function showRegister(){document.getElementById('login-container').style.display='none';document.getElementById('register-container').style.display='block';document.getElementById('login-msg').innerText='';}
function showLogin(){document.getElementById('login-container').style.display='block';document.getElementById('register-container').style.display='none';document.getElementById('script-container').style.display='none';}
function openCodeSite(){window.open("https://sub2unlock.me/MjMZMF6","_blank");}
async function login(){
    const u=document.getElementById("login-username").value.trim();
    const p=document.getElementById("login-password").value.trim();
    if(u==="BP0998"&&p==="9980"){currentUser={username:"BP0998",admin:false,lastLogin:new Date().toLocaleString(),sessionId:sessionId};localStorage.setItem("logged_in_user",JSON.stringify(currentUser));startUrlRandomizer();await showScript();return;}
    if(u==="admin"&&p==="2337952"){currentUser={username:"admin",admin:true,lastLogin:new Date().toLocaleString(),sessionId:sessionId};localStorage.setItem("logged_in_user",JSON.stringify(currentUser));startUrlRandomizer();await showScript();return;}
    document.getElementById("login-msg").innerText="Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
}

// ===== SHOW SCRIPT =====
async function showScript(){
    document.getElementById('login-container').style.display='none';
    document.getElementById('register-container').style.display='none';
    document.getElementById('script-container').style.display='block';
    document.getElementById('logout').style.display='block';
    document.getElementById('username-btn').style.display='block';
    document.getElementById('username-btn').innerText=currentUser.username;
    loginTime=new Date();
    startTimer();
    if(currentUser.admin)document.getElementById('add-script-btn').style.display='block';
    await loadScripts();
    renderScripts();
}

// ===== LOGOUT =====
async function logout(){
    currentUser=null;
    clearInterval(intervalTimer);clearInterval(syncTimer);clearInterval(heartbeatTimer);
    localStorage.removeItem("logged_in_user");
    document.getElementById('script-container').style.display='none';
    document.getElementById('logout').style.display='none';
    document.getElementById('username-btn').style.display='none';
    showLogin();
}

// ===== SCRIPTS =====
async function loadScripts(){const saved=JSON.parse(localStorage.getItem('scripts_data'));scripts=(saved&&saved.length>0)?saved:[...initialScripts];if(!saved)await saveScripts();}
async function saveScripts(){localStorage.setItem('scripts_data',JSON.stringify(scripts));}
function renderScripts(){const container=document.getElementById('scripts-list');container.innerHTML='';scripts.forEach(s=>container.appendChild(createScriptBox(s)));}
function createScriptBox(script){
    const box=document.createElement('div');box.className='box';box.id='box-'+script.id;
    let html=`<h3 id="title-${script.id}" contenteditable="false">${script.title}</h3><textarea id="text-${script.id}" readonly>${script.content}</textarea><button onclick="copyFrom('text-${script.id}')">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>`;
    if(currentUser.admin){
        html+=`<button id="edit-${script.id}" class="edit-btn" onclick="editScript(${script.id})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button id="save-${script.id}" class="save-btn" style="display:none;" onclick="saveScript(${script.id})">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button><button id="cancel-${script.id}" class="cancel-btn" style="display:none;" onclick="cancelEdit(${script.id})">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button class="delete-btn" onclick="deleteScript(${script.id})">üóëÔ∏è ‡∏•‡∏ö</button>`;
    }
    html+=`<div id="text-${script.id}-msg" class="msg">‚úî ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</div><div id="editing-${script.id}" class="editing-indicator">üî¥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç...</div>`;
    box.innerHTML=html;return box;
}
async function addNewScript(){const newId=Date.now();const newScript={id:newId,title:"Script ‡πÉ‡∏´‡∏°‡πà",content:"// ‡πÉ‡∏™‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"};scripts.push(newScript);await saveScripts();renderScripts();}
async function deleteScript(id){if(!confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ?'))return;scripts=scripts.filter(s=>s.id!==id);await saveScripts();renderScripts();}

// ===== EDIT =====
let originalContent={};
async function editScript(id){const ta=document.getElementById('text-'+id);const title=document.getElementById('title-'+id);originalContent[id]={text:ta.value,title:title.innerText};ta.readOnly=false;ta.style.background='#1a3a1a';title.contentEditable=true;title.style.outline='2px solid #ff9800';document.getElementById('edit-'+id).style.display='none';document.getElementById('save-'+id).style.display='inline-block';document.getElementById('cancel-'+id).style.display='inline-block';}
async function saveScript(id){const ta=document.getElementById('text-'+id);const title=document.getElementById('title-'+id);const index=scripts.findIndex(s=>s.id===id);if(index!==-1){scripts[index].title=title.innerText.trim();scripts[index].content=ta.value;await saveScripts();}ta.readOnly=true;ta.style.background='#222';title.contentEditable=false;title.style.outline='none';document.getElementById('edit-'+id).style.display='inline-block';document.getElementById('save-'+id).style.display='none';document.getElementById('cancel-'+id).style.display='none';showMsg('text-'+id);}
async function cancelEdit(id){const ta=document.getElementById('text-'+id);const title=document.getElementById('title-'+id);ta.value=originalContent[id].text;title.innerText=originalContent[id].title;ta.readOnly=true;ta.style.background='#222';title.contentEditable=false;title.style.outline='none';document.getElementById('edit-'+id).style.display='inline-block';document.getElementById('save-'+id).style.display='none';document.getElementById('cancel-'+id).style.display='none';}

// ===== UTILITY =====
function copyFrom(id){const ta=document.getElementById(id);if(!ta)return;navigator.clipboard.writeText(ta.value).then(()=>showMsg(id));}
function showMsg(id){const msg=document.getElementById(id+'-msg');if(!msg)return;msg.style.display='block';setTimeout(()=>msg.style.display='none',2000);}
function toggleUserTime(){const box=document.getElementById('user-time-box');box.style.display=(box.style.display==='none'||box.style.display==='')?'block':'none';}
function startTimer(){intervalTimer=setInterval(()=>{if(!currentUser)return;let timeHTML=`‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö: ${Math.floor((new Date()-loginTime)/1000)} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ<br>`;timeHTML+=`üïê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö: ${currentUser.lastLogin}`;document.getElementById('user-time-box').innerHTML=timeHTML;},1000);}

// ===== CLEAR DATA EXCEPT LOGIN =====
async function clearDataExceptLogin(){
    for(let i=localStorage.length-1;i>=0;i--){const key=localStorage.key(i);if(key!=='logged_in_user')localStorage.removeItem(key);}
}

// ===== WINDOW ONLOAD =====
window.onload=async function(){
    startUrlRandomizer();
    await clearDataExceptLogin();
    const stored=localStorage.getItem("logged_in_user");
    if(stored){
        try{currentUser=JSON.parse(stored);currentUser.sessionId=sessionId;localStorage.setItem("logged_in_user",JSON.stringify(currentUser));await showScript();}
        catch(e){console.error(e);showLogin();}
    }else{showLogin();}
}
</script>
</body>
</html>
